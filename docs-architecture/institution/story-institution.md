---
title: Story - Institution Module
category: integration-test
created: 2026-01-26
author: linus-torvalds
version: 1.0
status: draft
module: institution
filename: story-institution.md
---

# Story - 机构模块集成测试

> **模块**: institution | **测试类型**: integration | **路径**: `tests/integration/institution/`

> **测试原则**: 集成测试(20%) 验证端到端用户流程，单元测试(80%) 覆盖所有API逻辑

---

## US13: 机构入驻申请

### 用户故事

```
作为 机构代表
我希望 申请入驻平台
以便 展示机构信息和发布课程
```

### 测试用例

#### Happy Path

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 培训机构正常申请 | 用户已注册，非机构 | 提交机构完整信息 | 申请创建成功，状态pending |
| TC02-HP | 学校类型申请 | 用户已注册 | 选择学校类型 | 申请创建成功 |
| TC03-HP | 工作室类型申请 | 用户已注册 | 选择工作室类型 | 申请创建成功 |
| TC04-HP | 上传营业执照 | 申请中 | 上传有效执照 | 执照上传成功 |
| TC05-HP | 查看申请进度 | 已有申请 | 查询进度 | 返回正确进度信息 |
| TC06-HP | 管理员审核通过 | 申请待审核 | 审核通过 | 申请通过，创建机构档案 |
| TC07-HP | 管理员审核拒绝 | 申请待审核 | 审核拒绝 | 申请拒绝，发送通知 |
| TC08-HP | 补充材料后重新提交 | 申请需补充 | 更新并提交 | 重新进入待审核 |

#### Failed Cases

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 重复申请 | 有进行中申请 | 再次提交 | 提示已有进行中申请 |
| TC02-FC | 已是机构再次申请 | 已是认证机构 | 提交申请 | 提示已是认证机构 |
| TC03-FC | 缺少机构名称 | 无 | 不填机构名 | 提示必填 |
| TC04-FC | 无效营业执照 | 无 | 上传无效文件 | 提示文件无效 |
| TC05-FC | 执照过期 | 无 | 提交过期执照 | 提示执照已过期 |
| TC06-FC | 越权操作 | 其他用户申请 | 尝试操作 | 提示无权限 |

#### Edge Cases

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 特殊机构名称 | 无 | 含特殊字符名称 | 正确处理 |
| TC02-EC | 多个营业执上传 | 无 | 上传多个文件 | 全部保存 |
| TC03-EC | 并发审核 | 两个管理员 | 同时审核 | 一个成功，一个提示已处理 |
| TC04-EC | 机构地址超长 | 无 | 输入超长地址 | 正确处理 |

---

## US14: 机构管理

### 用户故事

```
作为 机构管理员
我希望 管理我的机构信息和课程
以便 展示机构特色和招生
```

### 测试用例

#### Happy Path

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看机构主页 | 已是机构 | 访问主页 | 显示公开信息 |
| TC02-HP | 更新机构简介 | 已是机构 | 修改description | 更新成功 |
| TC03-HP | 更新联系方式 | 已是机构 | 修改contact | 更新成功 |
| TC04-HP | 更新地址 | 已是机构 | 修改address | 更新成功 |
| TC05-HP | 上传机构图片 | 已是机构 | 上传图片 | 上传成功 |
| TC06-HP | 查看统计数据 | 已是机构 | 查询数据 | 返回统计信息 |

#### Failed Cases

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 非机构访问 | 非机构 | 访问机构管理 | 提示无权限 |
| TC02-FC | 上传非法格式 | 已是机构 | 上传非图片 | 提示格式不支持 |
| TC03-FC | 更新他人机构 | 非该机构管理员 | 尝试更新 | 提示无权限 |

#### Edge Cases

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 并发更新 | 已是机构 | 多请求同时更新 | 最终一致 |
| TC02-EC | 特殊字符处理 | 已是机构 | 含emoji内容 | 正确保存 |
| TC03-EC | 图片过大 | 已是机构 | 上传超大图片 | 提示或压缩 |

---

## US15: 机构课程管理

### 用户故事

```
作为 机构管理员
我希望 管理机构的课程
以便 发布和调整课程信息
```

### 测试用例

#### Happy Path

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 发布新课程 | 已是机构 | 创建课程 | 课程创建成功 |
| TC02-HP | 更新课程信息 | 已有课程 | 修改课程 | 更新成功 |
| TC03-HP | 上架课程 | 课程已下架 | 上架操作 | 课程上架成功 |
| TC04-HP | 下架课程 | 课程已上架 | 下架操作 | 课程下架成功 |
| TC05-HP | 删除课程 | 已有课程 | 删除课程 | 课程删除成功 |
| TC06-HP | 查看课程列表 | 已是机构 | 查询列表 | 返回分页数据 |
| TC07-HP | 查看课程统计 | 已有课程 | 查询统计 | 返回统计数据 |

#### Failed Cases

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 非机构发布课程 | 非机构 | 创建课程 | 提示无权限 |
| TC02-FC | 更新他人课程 | 其他机构课程 | 修改课程 | 提示无权限 |
| TC03-FC | 删除他人课程 | 其他机构课程 | 删除课程 | 提示无权限 |
| TC04-FC | 下架有预约课程 | 有待处理预约 | 下架操作 | 提示有待处理预约 |
| TC05-FC | 课程信息不完整 | 无 | 创建空白课程 | 提示必填字段 |

#### Edge Cases

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 大量课程管理 | 机构有100+课程 | 分页查询 | 返回正确分页 |
| TC02-EC | 并发更新 | 已有课程 | 多请求更新 | 最终一致 |
| TC03-EC | 课程名称特殊字符 | 无 | 含特殊字符名称 | 正确保存 |
| TC04-EC | 价格极端值 | 无 | 设置0或极大价格 | 正确处理 |

---

## 测试数据

```typescript
// 测试数据
const testInstitutions = [
  {
    id: 'inst-001',
    userId: 'user-001',
    name: '奥克兰数学培训中心',
    type: 'training_center',
    city: 'Auckland',
    status: 'active',
    trustLevel: 'A',
  },
];

const testApplications = [
  {
    id: 'app-inst-001',
    userId: 'user-001',
    orgName: '新机构',
    orgType: 'training_center',
    status: 'pending',
  },
];
```

---

## 相关文档

| 文档 | 路径 |
|------|------|
| 机构入驻技术架构 | ../institution/tech-institution-onboarding.md |
| 机构管理技术架构 | ../institution/tech-institution-management.md |
| 机构产品设计 | ../../05-product-design/institution/institution-onboarding.md |

---

**文档路径**: `/Users/dianwenwang/Project/idea/06-tech-architecture/institution/institution-stories.md`
