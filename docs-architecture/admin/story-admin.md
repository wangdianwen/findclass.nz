---
title: Story - Admin Module
category: integration-test
created: 2026-01-26
author: linus-torvalds
version: 1.0
status: draft
module: admin
filename: story-admin.md
---

# Story - 管理后台模块集成测试

> **模块**: admin | **测试类型**: integration | **路径**: `tests/integration/admin/`

> **测试原则**: 集成测试(20%) 验证端到端用户流程，单元测试(80%) 覆盖所有API逻辑

---

## US23: 管理员仪表盘

### 用户故事

```
作为 平台管理员
我希望 查看平台运营数据概览
以便 了解平台整体运营状况
```

### 测试用例

#### Happy Path - 仪表盘流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看数据概览 | 管理员已登录 | 访问仪表盘 | 显示关键指标 |
| TC02-HP | 查看用户增长趋势 | 管理员已登录 | 查看用户数据 | 显示用户增长图表 |
| TC03-HP | 查看预约趋势 | 管理员已登录 | 查看预约数据 | 显示预约趋势图 |
| TC04-HP | 查看收入统计 | 管理员已登录 | 查看收入数据 | 显示收入统计 |
| TC05-HP | 查看待处理事项 | 管理员已登录 | 查看待处理 | 显示待审核数量 |

#### Failed Cases - 权限失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 非管理员访问 | 普通用户 | 访问仪表盘 | 返回403 |
| TC02-FC | 子管理员权限不足 | 子管理员无仪表盘权限 | 访问 | 返回403 |
| TC03-FC | Token过期 | 管理员Token过期 | 访问 | 返回401 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 无数据时查看 | 平台新创建 | 查看仪表盘 | 显示0或空状态 |
| TC02-EC | 大数据量展示 | 平台运营1年 | 查看数据 | 正常加载展示 |
| TC03-EC | 并发访问 | 多个管理员同时访问 | 同时查看 | 正常响应 |

---

## US24: 用户管理

### 用户故事

```
作为 平台管理员
我希望 管理平台用户
以便 处理用户问题和维护平台秩序
```

### 测试用例

#### Happy Path - 用户管理流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看用户列表 | 管理员已登录 | 查询用户列表 | 返回分页用户 |
| TC02-HP | 查看用户详情 | 管理员已登录 | 查询用户详情 | 返回完整信息 |
| TC03-HP | 搜索用户 | 管理员已登录 | 按邮箱/姓名搜索 | 返回匹配用户 |
| TC04-HP | 禁用用户 | 管理员已登录 | 禁用用户 | 用户状态变disabled |
| TC05-HP | 启用用户 | 用户已禁用 | 启用用户 | 用户状态变active |
| TC06-HP | 查看用户预约记录 | 管理员已登录 | 查询预约记录 | 返回预约历史 |
| TC07-HP | 查看用户支付记录 | 管理员已登录 | 查询支付记录 | 返回支付历史 |

#### Failed Cases - 管理失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 查看不存在的用户 | - | 查询 | 返回404 |
| TC02-FC | 禁用超级管理员 | - | 禁用 | 提示不可禁用 |
| TC03-FC | 越权管理 | 普通用户 | 禁用他人 | 返回403 |
| TC04-FC | 搜索空关键词 | - | 不输入搜索 | 返回全部或提示 |
| TC05-FC | 批量禁用超限 | - | 一次禁用100个 | 提示数量限制 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 大量用户查询 | 平台有10000+用户 | 分页查询 | 返回正确分页 |
| TC02-EC | 用户数据敏感字段 | 查看用户 | 检查敏感信息 | 部分字段脱敏显示 |
| TC03-EC | 并发禁用同一用户 | 多个管理员 | 同时禁用 | 一个成功，其他提示不存在 |
| TC04-EC | 用户名特殊字符 | 用户名含emoji | 搜索/显示 | 正确处理 |
| TC05-EC | 用户状态异常 | 用户状态异常 | 查询 | 显示异常状态 |

---

## US25: 教师申请审核

### 用户故事

```
作为 平台管理员
我希望 审核教师入驻申请
以便 确保教师质量
```

### 测试用例

#### Happy Path - 审核流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看待审核列表 | 管理员已登录 | 查询待审核 | 返回待审核列表 |
| TC02-HP | 查看申请详情 | 管理员已登录 | 查询详情 | 返回完整申请信息 |
| TC03-HP | 下载资质文件 | 管理员已登录 | 下载文件 | 文件下载成功 |
| TC04-HP | 审核通过 | 申请待审核 | 通过操作 | 申请变approved，教师档案创建 |
| TC05-HP | 审核拒绝 | 申请待审核 | 拒绝操作 | 申请变rejected，发送邮件 |
| TC06-HP | 要求补充材料 | 申请待审核 | 标记需补充 | 申请变revision_required |
| TC07-HP | 查看审核历史 | 管理员已登录 | 查询历史 | 返回审核记录 |

#### Failed Cases - 审核失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 审核不存在的申请 | - | 审核 | 返回404 |
| TC02-FC | 重复审核 | 申请已审核 | 再次审核 | 提示已审核 |
| TC03-FC | 审核被退回的申请 | 申请被要求补充 | 直接通过 | 提示需先补充材料 |
| TC04-FC | 越权审核 | 无审核权限 | 审核 | 返回403 |
| TC05-FC | 审核意见为空 | 申请待审核 | 拒绝但无意见 | 提示需填写原因 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 并发审核同一申请 | 两个管理员 | 同时审核 | 一个成功，一个提示已处理 |
| TC02-EC | 审核超时自动处理 | 申请pending超48h | 查看状态 | 可能自动处理或标记 |
| TC03-EC | 大量待审核申请 | 有100+待审核 | 分页查看 | 正确分页 |
| TC04-EC | 资质文件下载失败 | 文件存储异常 | 下载 | 提示下载失败 |
| TC05-EC | 审核统计 | 查看统计数据 | 生成报表 | 返回统计数据 |

---

## US26: 数据分析

### 用户故事

```
作为 平台管理员
我希望 查看详细的数据分析报告
以便 做出数据驱动的决策
```

### 测试用例

#### Happy Path - 分析流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 用户数据分析 | 管理员已登录 | 查看用户分析 | 返回用户统计数据 |
| TC02-HP | 课程数据分析 | 管理员已登录 | 查看课程分析 | 返回课程统计数据 |
| TC03-HP | 收入数据分析 | 管理员已登录 | 查看收入分析 | 返回收入统计 |
| TC04-HP | 预约转化率分析 | 管理员已登录 | 查看转化率 | 返回转化漏斗 |
| TC05-HP | 导出报表 | 管理员已登录 | 导出数据 | 报表下载成功 |
| TC06-HP | 自定义时间范围 | 管理员已登录 | 选择时间范围 | 返回对应数据 |

#### Failed Cases - 分析失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 无数据时分析 | 平台新创建 | 查看分析 | 显示空数据 |
| TC02-FC | 时间范围无效 | - | 选择无效范围 | 提示错误 |
| TC03-FC | 导出过大报表 | - | 导出全量数据 | 提示数据量过大 |
| TC04-FC | 无权限导出 | 无导出权限 | 导出 | 返回403 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 极端时间查询 | 查询10年数据 | 生成报表 | 正确处理或提示 |
| TC02-EC | 并发生成报表 | 多个管理员 | 同时生成 | 队列处理或部分失败 |
| TC03-EC | 敏感数据展示 | 查看用户详情 | 检查敏感信息 | 部分字段脱敏 |
| TC04-EC | 图表数据为空 | 无数据 | 查看图表 | 显示空图表状态 |

---

## 测试数据

```typescript
// 测试数据
const testAdminUsers = [
  {
    id: 'admin-001',
    email: 'admin@example.com',
    role: 'super_admin',
    permissions: ['all'],
    status: 'active',
  },
  {
    id: 'admin-002',
    email: 'moderator@example.com',
    role: 'moderator',
    permissions: ['users:read', 'applications:review'],
    status: 'active',
  },
];

const testPendingApplications = [
  {
    id: 'app-001',
    userId: 'user-001',
    applicationType: 'individual',
    status: 'pending',
    submittedAt: '2026-01-26T10:00:00Z',
  },
];
```

---

## 相关文档

| 文档 | 路径 |
|------|------|
| 管理后台技术架构 | ../admin/tech-admin-backend.md |
| 数据分析技术架构 | ../admin/tech-analytics.md |
| 管理后台产品设计 | ../../05-product-design/admin/admin-backend.md |

---

**文档路径**: `/Users/dianwenwang/Project/idea/06-tech-architecture/admin/admin-stories.md`
