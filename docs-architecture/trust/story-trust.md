---
title: Story - Trust Module
category: integration-test
created: 2026-01-26
author: linus-torvalds
version: 1.0
status: draft
module: trust
filename: story-trust.md
---

# Story - 信任模块集成测试

> **模块**: trust | **测试类型**: integration | **路径**: `tests/integration/trust/`

> **测试原则**: 集成测试(20%) 验证端到端用户流程，单元测试(80%) 覆盖所有API逻辑

---

## US27: 信任等级标识

### 用户故事

```
作为 平台用户
我希望 查看教师/机构的信任等级标识
以便 识别可信的服务提供者
```

### 测试用例

#### Happy Path - 信任标识流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看教师信任等级 | 用户浏览教师 | 查看教师详情 | 显示信任等级S/A/B |
| TC02-HP | 查看机构信任等级 | 用户浏览机构 | 查看机构详情 | 显示信任等级 |
| TC03-HP | 查看信任等级说明 | 用户已登录 | 点击信任标识 | 显示等级说明 |
| TC04-HP | 查看信任等级规则 | 用户已登录 | 查看规则说明 | 显示升级规则 |
| TC05-HP | 信任等级提升 | 教师满足升级条件 | 检查等级 | 等级自动/手动提升 |

#### Failed Cases - 信任失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 查看不存在的信任等级 | - | 查询 | 返回404 |
| TC02-FC | 信任等级显示错误 | 教师状态异常 | 查看 | 显示默认或异常状态 |
| TC03-FC | 信任等级计算错误 | 数据异常 | 重新计算 | 正确重新计算 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 信任等级边界值 | 正好达到升级条件 | 检查升级 | 按规则判断 |
| TC02-EC | 多因素信任计算 | 多个影响因子 | 计算等级 | 综合计算正确 |
| TC03-EC | 信任等级降级 | 触发降级条件 | 检查等级 | 等级正确下降 |
| TC04-EC | 并发等级更新 | 多个更新同时 | 更新等级 | 最终一致性 |

---

## US28: 数据质量

### 用户故事

```
作为 平台管理员
我希望 管理平台数据质量
以便 确保信息准确性和可靠性
```

### 测试用例

#### Happy Path - 数据质量管理

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看数据质量报告 | 管理员已登录 | 查看报告 | 返回质量指标 |
| TC02-HP | 检测重复数据 | 管理员已登录 | 运行检测 | 返回重复记录 |
| TC03-HP | 标记低质量数据 | 管理员已登录 | 标记数据 | 标记成功 |
| TC04-HP | 查看数据问题列表 | 管理员已登录 | 查询问题 | 返回问题列表 |
| TC05-HP | 处理数据问题 | 管理员已登录 | 处理问题 | 问题状态更新 |
| TC06-HP | 数据质量趋势 | 管理员已登录 | 查看趋势 | 返回趋势图数据 |

#### Failed Cases - 数据质量失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 访问无权限 | 普通用户 | 查看报告 | 返回403 |
| TC02-FC | 处理不存在的记录 | - | 处理 | 返回404 |
| TC03-FC | 批量处理超限 | - | 一次处理1000条 | 提示数量限制 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 全量数据检测 | 平台有大量数据 | 运行检测 | 正确分批处理 |
| TC02-EC | 检测超时 | 数据量极大 | 检测 | 返回超时或继续处理 |
| TC03-EC | 问题数据误判 | 数据正常被标记 | 申诉 | 恢复数据状态 |

---

## US29: 数据聚合

### 用户故事

```
作为 平台用户
我希望 查看来自多方的数据聚合
以便 获得全面的信息参考
```

### 测试用例

#### Happy Path - 数据聚合流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看聚合课程信息 | 用户浏览课程 | 查看详情 | 显示来自各平台的数据 |
| TC02-HP | 查看数据来源 | 用户已登录 | 点击数据来源 | 显示原始来源 |
| TC03-HP | 查看更新时间 | 用户已登录 | 查看时间 | 显示最后更新时间 |
| TC04-HP | 数据源失效处理 | 数据源失效 | 查看数据 | 显示失效状态或移除 |

#### Failed Cases - 数据聚合失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 聚合数据不存在 | - | 查询 | 返回空或404 |
| TC02-FC | 数据源全部失效 | 所有源不可用 | 查看 | 显示无数据 |
| TC03-FC | 聚合超时 | 数据源响应慢 | 查看 | 返回超时或缓存数据 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 多数据源合并 | 同一信息来自多源 | 合并展示 | 去重后展示 |
| TC02-EC | 数据冲突 | 多源数据不一致 | 展示 | 按优先级展示或标注 |
| TC03-EC | 缓存失效 | 缓存过期 | 查看 | 重新抓取或返回过期数据 |
| TC04-EC | 大数据量聚合 | 大量数据需要聚合 | 聚合 | 正确处理不超时 |

---

## US30: 数据脱敏

### 用户故事

```
作为 平台用户
我希望 查看脱敏后的联系方式
以便 保护隐私同时获得联系渠道
```

### 测试用例

#### Happy Path - 数据脱敏流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看脱敏手机号 | 用户浏览课程 | 查看联系方式 | 手机号显示为021****567 |
| TC02-HP | 查看脱敏邮箱 | 用户浏览课程 | 查看邮箱 | 邮箱显示为te***@example.com |
| TC03-HP | 查看脱敏微信号 | 用户浏览课程 | 查看微信 | 微信号显示为WeChat*** |
| TC04-HP | 获取完整联系方式 | 已登录用户 | 点击获取完整 | 显示完整信息（有时效限制） |
| TC05-HP | 机构完整联系方式 | 机构已认证 | 查看 | 显示完整联系方式 |

#### Failed Cases - 脱敏失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 未登录获取完整联系 | 用户未登录 | 点击获取 | 引导登录 |
| TC02-FC | 权限不足获取 | 已登录但无权限 | 点击获取 | 提示权限不足 |
| TC03-FC | 获取已过期 | 之前已获取 | 再次获取 | 需重新请求 |
| TC04-FC | 查看不存在的联系方式 | - | 查看 | 返回空 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 特殊手机号格式 | 非标准格式 | 脱敏处理 | 正确处理各种格式 |
| TC02-EC | 邮箱用户名很短 | 如@a.com | 脱敏 | 正确显示 |
| TC03-EC | 联系方式时效性 | 获取后超过时效 | 查看 | 重新脱敏显示 |
| TC04-EC | 并发获取同一联系 | 多个用户 | 同时获取 | 各自独立计时 |
| TC05-EC | 脱敏数据泄露检测 | - | 安全检查 | 无明文泄露 |

---

## US31: 课程评价

### 用户故事

```
作为 家长
我希望 对完成的课程进行评价
以便 帮助其他家长做出选择
```

### 测试用例

#### Happy Path - 评价流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 提交课程评价 | 预约已完成 | 提交评价 | 评价创建成功 |
| TC02-HP | 提交带评分评价 | 预约已完成 | 提交带评分 | 评价和评分创建成功 |
| TC03-HP | 查看课程评价列表 | 用户浏览课程 | 查看评价 | 返回分页评价 |
| TC04-HP | 查看评价详情 | 用户已登录 | 查看详情 | 返回完整评价 |
| TC05-HP | 追加评价 | 已评价 | 追加内容 | 追评成功 |
| TC06-HP | 查看课程平均评分 | 用户浏览课程 | 查看评分 | 显示平均分和评价数 |
| TC07-HP | 按评分筛选评价 | 用户浏览课程 | 筛选4.5分+ | 返回高评评价 |

#### Failed Cases - 评价失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 未完成课程评价 | 课程未完成 | 提交评价 | 提示不可评价 |
| TC02-FC | 重复评价同一预约 | 已评价 | 再次评价 | 提示已评价 |
| TC03-FC | 评价内容为空 | - | 提交空内容 | 提示内容不能为空 |
| TC04-FC | 评价内容过长 | - | 输入超长内容 | 提示超出限制 |
| TC05-FC | 评价不存在的课程 | - | 评价 | 返回404 |
| TC06-FC | 查看被删除评价 | 评价已删除 | 查看 | 返回已删除状态 |
| TC07-FC | 越权删除他人评价 | 非评价者 | 删除 | 返回403 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 敏感词评价 | 含敏感词 | 提交 | 自动过滤或拒绝 |
| TC02-EC | Emoji评价 | 仅表情 | 提交 | 允许或拒绝 |
| TC03-EC | 评价时效限制 | 超过30天 | 评价 | 提示超出评价时限 |
| TC04-EC | 大量评价分页 | 课程有1000+评价 | 分页查看 | 正确分页 |
| TC05-EC | 评价排序 | 用户选择 | 按时间/按评分排序 | 正确排序 |
| TC06-EC | 并发提交评价 | 同一预约 | 多次提交 | 只有一个成功 |
| TC07-EC | 评价统计实时性 | 大量评价 | 查看评分 | 可能延迟更新 |

---

## 测试数据

```typescript
// 测试数据
const testTrustLevels = [
  {
    id: 'trust-001',
    level: 'S',
    name: '优质认证',
    criteria: '评分4.8+，100+评价，无投诉',
  },
  {
    id: 'trust-002',
    level: 'A',
    name: '可信',
    criteria: '评分4.5+，50+评价',
  },
];

const testReviews = [
  {
    id: 'review-001',
    courseId: 'course-001',
    userId: 'user-001',
    rating: 5,
    content: '老师讲得很好，孩子很喜欢',
    status: 'published',
    createdAt: '2026-01-26T10:00:00Z',
  },
];

const testDesensitizedData = [
  {
    original: '0211234567',
    masked: '021****567',
  },
  {
    original: 'teacher@example.com',
    masked: 'tea***@example.com',
  },
];
```

---

## 相关文档

| 文档 | 路径 |
|------|------|
| 信任等级技术架构 | ../trust/tech-trust-badges.md |
| 数据质量技术架构 | ../trust/tech-data-quality.md |
| 数据聚合技术架构 | ../trust/tech-data-aggregation.md |
| 数据脱敏技术架构 | ../trust/tech-desensitization.md |
| 课程评价技术架构 | ../course/tech-course-reviews.md |
| 信任产品设计 | ../../05-product-design/trust/trust-badges.md |

---

**文档路径**: `/Users/dianwenwang/Project/idea/06-tech-architecture/trust/trust-stories.md`
