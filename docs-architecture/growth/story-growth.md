---
title: Story - Growth Module
category: integration-test
created: 2026-01-26
author: linus-torvalds
version: 1.0
status: draft
module: growth
filename: story-growth.md
---

# Story - 增长模块集成测试

> **模块**: growth | **测试类型**: integration | **路径**: `tests/integration/growth/`

> **测试原则**: 集成测试(20%) 验证端到端用户流程，单元测试(80%) 覆盖所有API逻辑

---

## US20: 推荐好友

### 用户故事

```
作为 已注册用户
我希望 分享我的推荐码给好友
以便 获得推荐奖励
```

### 测试用例

#### Happy Path - 推荐流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 获取我的推荐码 | 用户已登录 | 查询推荐码 | 返回推荐码 |
| TC02-HP | 生成推荐码 | 用户无推荐码 | 生成推荐码 | 推荐码创建成功 |
| TC03-HP | 好友使用推荐码注册 | 好友未注册 | 使用推荐码注册 | 推荐关系建立 |
| TC04-HP | 好友完成首次预约 | 好友已注册，使用推荐码 | 完成首次预约 | 触发奖励发放 |
| TC05-HP | 查看推荐历史 | 已有推荐记录 | 查询历史 | 返回推荐列表 |
| TC06-HP | 查看我的奖励 | 已有奖励 | 查询奖励 | 返回奖励信息 |
| TC07-HP | 奖励到账 | 好友完成首次预约 | 查看账户余额 | 奖励已入账 |

#### Failed Cases - 推荐失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 使用无效推荐码 | 好友未注册 | 输入无效码 | 提示推荐码无效 |
| TC02-FC | 使用过期推荐码 | 好友未注册 | 使用过期码 | 提示推荐码已过期 |
| TC03-FC | 使用已达上限推荐码 | 好友未注册 | 使用已达上限码 | 提示已达使用上限 |
| TC04-FC | 重复推荐同一用户 | 已被推荐 | 再次推荐 | 提示已是被推荐用户 |
| TC05-FC | 自己使用自己推荐码 | 用户已登录 | 使用自己推荐码 | 提示不能使用自己推荐码 |
| TC06-FC | 查看他人推荐记录 | 非本人 | 尝试查询 | 返回403 |
| TC07-FC | 越权领取他人奖励 | 非本人奖励 | 尝试领取 | 返回403 |
| TC08-FC | 使用已使用的推荐码 | 好友已使用过 | 再次使用 | 提示已被使用 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 并发使用同一推荐码 | 多个用户同时注册 | 同时使用同一推荐码 | 都建立推荐关系（按使用次数限制） |
| TC02-EC | 推荐码极限长度 | 用户生成 | 生成特殊格式码 | 正确生成 |
| TC03-EC | 奖励计算 | 好友完成多次预约 | 检查奖励 | 按规则计算奖励 |
| TC04-EC | 奖励过期 | 奖励长期未使用 | 检查过期 | 正确处理过期 |
| TC05-EC | 大量推荐记录 | 用户推荐了50+好友 | 分页查询 | 返回正确分页 |
| TC06-EC | 推荐码特殊字符 | 生成推荐码 | 含特殊字符 | 正确处理 |
| TC07-EC | 网络中断恢复 | 注册中断 | 重新注册使用码 | 推荐关系正确建立 |

---

## US21: 捐赠功能

### 用户故事

```
作为 热心用户
我希望 向困难学生捐赠课程费用
以便 帮助他们获得学习机会
```

### 测试用例

#### Happy Path - 捐赠流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看捐赠项目 | 用户已登录 | 浏览捐赠项目 | 返回可捐赠项目列表 |
| TC02-HP | 发起捐赠 | 用户已登录 | 选择金额捐赠 | 捐赠创建成功 |
| TC03-HP | 捐赠支付成功 | 捐赠待支付 | 支付成功 | 捐赠完成，受益人收到 |
| TC04-HP | 查看我的捐赠 | 已有捐赠记录 | 查询历史 | 返回捐赠记录 |
| TC05-HP | 查看受益人反馈 | 捐赠已使用 | 查看反馈 | 返回受益人反馈 |
| TC06-HP | 取消未支付捐赠 | 捐赠未支付 | 取消捐赠 | 捐赠取消成功 |

#### Failed Cases - 捐赠失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 捐赠不存在的项目 | - | 捐赠 | 返回404 |
| TC02-FC | 捐赠金额过低 | - | 捐赠0.01NZD | 提示金额过低 |
| TC03-FC | 捐赠金额过高 | - | 捐赠超大金额 | 提示超出限制 |
| TC04-FC | 支付失败 | 捐赠待支付 | 支付失败 | 捐赠保持待支付状态 |
| TC05-FC | 取消已支付捐赠 | 捐赠已支付 | 取消 | 提示已支付不可取消 |
| TC06-FC | 查看他人捐赠记录 | 非本人 | 尝试查询 | 返回403（匿名捐赠） |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 匿名捐赠 | 用户选择匿名 | 捐赠 | 捐赠记录匿名 |
| TC02-EC | 捐赠项目已筹满 | 项目已达标 | 捐赠 | 提示已满或转入其他项目 |
| TC03-EC | 大额捐赠 | 捐赠大额金额 | 捐赠成功 | 正常处理 |
| TC04-EC | 捐赠到账延迟 | 支付成功 | 立即查看 | 显示处理中 |
| TC05-EC | 捐赠取消时限 | 捐赠超过取消时限 | 取消 | 提示不可取消 |

---

## US22: 消息通知

### 用户故事

```
作为 平台用户
我希望 接收重要的消息通知
以便 不错过关键信息
```

### 测试用例

#### Happy Path - 通知流程

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-HP | 查看消息列表 | 用户已登录 | 查询消息列表 | 返回分页列表 |
| TC02-HP | 查看消息详情 | 有未读消息 | 查询详情 | 返回完整消息 |
| TC03-HP | 标记消息已读 | 有未读消息 | 标记已读 | 消息变已读 |
| TC04-HP | 全部标为已读 | 有多条未读 | 全部标为已读 | 所有消息变已读 |
| TC05-HP | 删除消息 | 有消息 | 删除 | 消息删除成功 |
| TC06-HP | 接收新消息通知 | 等待新消息 | 触发消息 | 收到通知 |
| TC07-HP | 通知设置 | 用户已登录 | 修改通知设置 | 设置保存成功 |

#### Failed Cases - 通知失败场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-FC | 查看不存在的消息 | - | 查询详情 | 返回404 |
| TC02-FC | 删除他人消息 | 其他用户消息 | 删除 | 返回403 |
| TC03-FC | 标记他人消息已读 | 其他用户消息 | 标记 | 返回403 |
| TC04-FC | 越权修改通知设置 | - | 修改他人设置 | 返回403 |
| TC05-FC | 通知类型不支持 | - | 订阅不支持类型 | 提示不支持 |

#### Edge Cases - 边界场景

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|----------|----------|----------|
| TC01-EC | 大量未读消息 | 有100+未读 | 全部标为已读 | 全部更新成功 |
| TC02-EC | 消息分页 | 有50+消息 | 分页查询 | 返回正确分页 |
| TC03-EC | 消息已删除 | 消息已删除 | 再次删除 | 提示不存在 |
| TC04-EC | 消息顺序 | 有多条消息 | 查看列表 | 按时间倒序 |
| TC05-EC | 通知偏好为空 | 用户未设置 | 查询设置 | 返回默认设置 |
| TC06-EC | 离线消息同步 | 重新上线 | 接收离线消息 | 消息完整同步 |

---

## 测试数据

```typescript
// 测试数据
const testReferrals = [
  {
    id: 'referral-001',
    referrerId: 'user-001',
    refereeId: 'user-002',
    status: 'completed',
    rewardAmount: 10,
    rewardClaimed: true,
  },
];

const testDonations = [
  {
    id: 'donation-001',
    donorId: 'user-001',
    beneficiaryId: 'user-003',
    amount: 50,
    status: 'completed',
    isAnonymous: false,
  },
];

const testNotifications = [
  {
    id: 'notif-001',
    userId: 'user-001',
    type: 'booking_reminder',
    title: '课程提醒',
    content: '您预约的课程即将开始',
    isRead: false,
    createdAt: '2026-01-26T10:00:00Z',
  },
];
```

---

## 相关文档

| 文档 | 路径 |
|------|------|
| 推荐系统技术架构 | ../growth/tech-referral.md |
| 捐赠技术架构 | ../growth/tech-donations.md |
| 通知技术架构 | ../growth/tech-notifications.md |
| 推荐产品设计 | ../../05-product-design/growth/referral.md |
| 捐赠产品设计 | ../../05-product-design/growth/donations.md |

---

**文档路径**: `/Users/dianwenwang/Project/idea/06-tech-architecture/growth/growth-stories.md`
